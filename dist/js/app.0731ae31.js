(function(e){function t(t){for(var i,o,r=t[0],l=t[1],c=t[2],d=0,p=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);h&&h(t);while(p.length)p.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,r=1;r<n.length;r++){var l=n[r];0!==a[l]&&(i=!1)}i&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={app:0},s=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var h=l;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},3451:function(e,t,n){"use strict";n("f54a")},"56d7":function(e,t,n){"use strict";n.r(t);var i=n("2b0e"),a=function(){var e=this,t=e._self._c;return t("div",[t("ThreeJs")],1)},s=[],o=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticStyle:{display:"flex",gap:"50px"}},[t("input",{attrs:{type:"file",accept:".gltf,.glb",multiple:""},on:{change:e.onFileChange}}),t("div",[e._v("名称："+e._s(e.nodeName))]),t("div",[e._v("坐标："+e._s(e.coordinateDisplay))]),t("div",[t("button",{on:{click:function(t){return e.disappearWallfun(2217802)}}},[e._v("隐藏墙壁")]),t("button",{on:{click:function(t){return e.disappearWallfun(1701952)}}},[e._v("隐藏柱子")]),t("button",{on:{click:function(t){return e.disappearWallfun(2239507)}}},[e._v("隐藏窗户")])])]),t("div",{ref:"canvasContainer",staticClass:"canvas-container"})])},r=[],l=n("5a89"),c=n("4721"),h=n("34ad"),d=n("32d9"),p=n("93e9"),u=n("4e15"),m=n("cee4"),f={name:"ThreeJs",data(){return{scene:new l["qb"],camera:new l["db"](75,window.innerWidth/window.innerHeight,.1,1e3),renderer:new l["Ib"]({antialias:!0}),controls:null,mouse:new l["Eb"],raycaster:new l["nb"],nodeName:"",coordinateDisplay:"",selectedObject:null,outlinePass:null,composer:null,renderPass:null,axesHelper:new l["d"](5),object:null,gltf:null,isDisappearWall:!1,elementDetail:null}},methods:{initScene(e){this.scene.background=new l["k"]("#191919");const t=(new l["f"]).setFromObject(e),n=t.getSize(new l["Fb"]).length(),i=t.getCenter(new l["Fb"]);e.position.sub(i),e.rotation.set(270,0,0),this.camera.near=n/100,this.camera.far=100*n,this.camera.fov=60,this.camera.position.copy(i),this.camera.position.x=8,this.camera.position.y=115,this.camera.position.z=195,this.camera.lookAt(i),this.camera.updateProjectionMatrix(),console.log(72,this.camera),console.log(73,n),this.scene.add(this.camera),this.renderer.setClearColor(13421772),this.renderer.setPixelRatio(window.devicePixelRatio);let a=window.innerWidth,s=window.innerHeight;this.renderer.setSize(a,s),this.$refs.canvasContainer.appendChild(this.renderer.domElement),this.controls=new c["a"](this.camera,this.renderer.domElement),this.controls.screenSpacePanning=!0;const o=new l["b"]("#fff",2);this.scene.add(o);const r=new l["m"]("#fff",1);r.position.set(1,1,1).normalize(),this.scene.add(r),this.composer=new d["a"](this.renderer),this.renderPass=new p["a"](this.scene,this.camera),this.composer.addPass(this.renderPass),this.outlinePass=new u["a"](new l["Eb"](window.innerWidth,window.innerHeight),this.scene,this.camera),this.outlinePass.visibleEdgeColor.set(16776960),this.composer.addPass(this.outlinePass),this.animate(),this.scene.add(e)},animate(){this.controls.update(),requestAnimationFrame(this.animate),this.raycaster.setFromCamera(this.mouse,this.camera),this.outlinePass.selectedObjects=this.selectedObject?[this.selectedObject]:[],this.composer.render()},onFileChange(e){const t=e.target.files[0];if(console.log(115,e.target.files),t){const e=new FileReader;e.onload=e=>{const t=e.target.result;this.loadGLTFModel(t)},e.readAsArrayBuffer(t)}},loadGLTFModel(e){const t=new h["a"];t.parse(e,"",e=>{this.gltf=e,console.log(132,"当前位置：",e.scene.position),this.initScene(e.scene),this.object=e.scene,console.log(136,"camera:",e.camera),window.addEventListener("click",this.handleClick),window.addEventListener("resize",this.handleResize)})},handleResize(){let e=window.innerWidth,t=window.innerHeight;this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()},handleClick(e){this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1,this.restoreHighlight(),this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.raycaster.intersectObjects(this.scene.children,!0);if(console.log("当前模型：",this.object),t.length>0){console.clear();let n=t[0].object,i=n.name;console.log("选中物体信息:",n),console.log("选中物体材质:",n.material),console.log("选中物体name:",i),this.nodeName=n.material.name,this.selectedObject=n;const a=t[0].point;this.coordinateDisplay=`(x轴：${a.x}, y轴：${a.y}, z轴：${a.z})`,this.setCamera(e,t),n.material.transparent=!0,1==n.material.opacity?n.material.opacity=.1:n.material.opacity=1;let s="/get?id="+i;m["a"].get(s,{baseURL:"http://localhost:3000",headers:{"Content-Type":"application/json"}}).then(e=>{this.elementDetail=e.data.data,this.elementDetail.forEach(e=>{(null!=e.value||e.value.length>0)&&console.log(`${e.category},${e.floor},${e.modelName} ---- ${e.propertyname} : ${null==e.value?"无":e.value}`)})}).catch(e=>{console.error(e)})}else this.selectedObject=null},highlight(e){console.log("选中ID：",e.id),e.material.emissive=new l["k"](16776960)},restoreHighlight(){this.scene.traverse(e=>{e.isMesh&&(e.material.emissive=new l["k"](0))})},disappearWallfun(e){console.log(231,this.isDisappearWall,e,this.object);let t="/getSameCategoryElement?id="+e;m["a"].get(t,{baseURL:"http://localhost:3000",headers:{"Content-Type":"application/json"}}).then(e=>{console.log("同类物体：",e.data.data);let t=e.data.data;0==this.isDisappearWall?this.object.children.forEach(e=>{t.includes(e.name)&&(e.material.visible=!1)}):this.object.children.forEach(e=>{t.includes(e.name)&&(e.material.visible=!0)})}).catch(e=>{console.error(e)}),1==this.isDisappearWall?this.isDisappearWall=!1:this.isDisappearWall=!0},setCamera(e,t){console.log(305,this.camera);this.camera.position;let n=t[0].object,i=n.geometry.boundingSphere,a=i.center.clone(),s=t[0].point;console.log(314,"选中元素中心点坐标：",a);let o=20,r=new l["Fb"](s.x,s.y+3*o,3*s.z);this.camera.position.copy(r),this.camera.lookAt(a)}}},g=f,b=n("2877"),w=Object(b["a"])(g,o,r,!1,null,"63a54f1e",null),v=w.exports,y={name:"App",components:{ThreeJs:v}},j=y,P=(n("3451"),Object(b["a"])(j,a,s,!1,null,null,null)),O=P.exports;i["a"].config.productionTip=!1,new i["a"]({render:e=>e(O)}).$mount("#app")},f54a:function(e,t,n){}});
//# sourceMappingURL=app.0731ae31.js.map